package golfCartServer;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.PrintWriter;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Scanner;

import app.App;
import vehicle.Vehicle;

public class Server {
	public static void main(String[] args) throws IOException {
		App app = new App();
		Vehicle receiver = new Vehicle();
		app.start();
		receiver.start();
    // 여기까지하면 이제 3개(main+sender+receiver)의 스레드가 작동하는 멀티스레드 프로그램
	}
	
	
	class Listener extends Thread {
		static boolean isAppConnected = false;
		static boolean isCartConnected = false;
		int DevicePort;
		ServerSocket socket;
		
		Listener(String device) throws IOException{
			if(device.equals("app")) DevicePort = 1234;
			else if(device.equals("cart")) DevicePort = 1235;
			socket = new ServerSocket(DevicePort);
		}
		@Override
		public void run() {
			try {
				System.out.println("Appsocket : " + DevicePort + "으로 서버가 열렸습니다");
				Socket socketUser = socket.accept();
				if(DevicePort == 1234) isAppConnected = true;
				else if(DevicePort == 1235) isCartConnected = true;
				while(true) {
					System.out.println("App가 접속함 : " + socketUser.getInetAddress());
					getMessage(socketUser);
				}
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		
		void getMessage(Socket socketUser) throws IOException {
			InputStream input = socketUser.getInputStream();
			BufferedReader br = new BufferedReader(new InputStreamReader(input));
			String identification = br.readLine();
			System.out.println(identification);
		}
		void sendMessage(Socket socketUser) throws IOException {
			OutputStream out = socketUser.getOutputStream();
			PrintWriter pr = new PrintWriter(out,true);
			Scanner s1 = new Scanner(System.in);
			pr.println(s1.next());
		}
	} // class
	
} // class