package chatting_server;

import java.io.DataInputStream;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.SocketException;

public class SocketServer {

  public static void main(String[] args) throws IOException {
    int port = 8888;
    ServerSocket socketServer = new ServerSocket(port);
    while(true) {
      Socket sock = socketServer.accept();
      System.out.println("ip : " + sock.getInetAddress() + " 와 연결되었습니다.");
      ReceiveThread receiveThread = new ReceiveThread(sock);
      receiveThread.start();
      SendThread sendThead = new SendThread(sock);
      sendThead.start();
    }
  }
}

class Receiver extends Thread {

	  private final Socket socket;

	  public Receiver(Socket socket) {
	    this.socket = socket;
	  }

	  @Override
	  public void run() {
	    try {
	      DataInputStream tmpbuf = new DataInputStream(socket.getInputStream());
	      String receiveString;
	      while (true) {
	        receiveString = tmpbuf.readUTF();
	        System.out.println(socket.getInetAddress() + " : " + receiveString);
	      }
	    } catch (SocketException e1) {
	      System.out.println(socket.getInetAddress() + " 연결이 종료되었습니다.");
	    } catch (IOException e2) {
	      e2.printStackTrace();
	    }
	  }

	}